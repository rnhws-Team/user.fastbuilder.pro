"use strict";(self.webpackChunkwebpages=self.webpackChunkwebpages||[]).push([[1],[,(e,r,t)=>{t.r(r),t.d(r,{default:()=>g});var n=t(865),i=t.n(n),a=t(578),s=t(2641),o="https://js.stripe.com/v3",l=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,c="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",p=null,u=Promise.resolve().then((function(){return e=null,null!==p||(p=new Promise((function(r,t){if("undefined"!=typeof window)if(window.Stripe&&e&&console.warn(c),window.Stripe)r(window.Stripe);else try{var n=function(){for(var e=document.querySelectorAll('script[src^="'.concat(o,'"]')),r=0;r<e.length;r++){var t=e[r];if(l.test(t.src))return t}return null}();n&&e?console.warn(c):n||(n=function(e){var r=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",t=document.createElement("script");t.src="".concat(o).concat(r);var n=document.head||document.body;if(!n)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return n.appendChild(t),t}(e)),n.addEventListener("load",(function(){window.Stripe?r(window.Stripe):t(new Error("Stripe.js not available"))})),n.addEventListener("error",(function(){t(new Error("Failed to load Stripe.js"))}))}catch(e){return void t(e)}else r(null)}))),p;var e})),d=!1;u.catch((function(e){d||console.warn(e)}));var w=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];d=!0;var n=Date.now();return u.then((function(e){return function(e,r,t){if(null===e)return null;var n=e.apply(void 0,r);return function(e,r){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"1.46.0",startTime:r})}(n,t),n}(e,r,n)}))};let f,m,h=null,y={info:"",isfree:!1,paired:!1,paired_notice:"",error:"",fatal:!1,success:!1,showcodepwnpay:!1,stripeloading:!1,iframeurl:"",showingcodepwnpay:!1,showingstripepay:!1,use_point_input:"",oninit:async()=>{y.showingstripepay=!1,y.stripeloading=!1,y.info="",y.paired=!1,y.isfree=!1,y.paired_notice="",y.error="",y.showingcodepwnpay=!1;let e=await s.Z.GetBill();"object"==typeof e&&(y.isfree=e.isfree,y.iframeurl=e.codepwn_pay_url,y.showcodepwnpay=e.codepwn_pay_available,y.can_use_point=e.can_use_point,y.use_point_input="",y.info=e.show.replace(/\n/g,"<br/>"),i().redraw(),e.success&&(h&&clearInterval(h),h=setInterval(v,1e3),f=e.test_key?await w(e.test_key):await w("pk_live_51MKodeE2lNjB2a2Nh6EKCAtmksHMWf8PrCs6EMK7dPdUHoTbyXcawldsiVs0iM9NTYxuU6llV50UupFmbjsUItms00aANHRiCT")))},onremove:()=>{h&&(clearInterval(h),h=null)},view:e=>i()(a.ZP.frame,{pageName:"支付",pageIcon:'<svg class="sectionTitle-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M551.991 64H144.28l-8.726-44.608C133.35 8.128 123.478 0 112 0H12C5.373 0 0 5.373 0 12v24c0 6.627 5.373 12 12 12h80.24l69.594 355.701C150.796 415.201 144 430.802 144 448c0 35.346 28.654 64 64 64s64-28.654 64-64a63.681 63.681 0 0 0-8.583-32h145.167a63.681 63.681 0 0 0-8.583 32c0 35.346 28.654 64 64 64 35.346 0 64-28.654 64-64 0-18.136-7.556-34.496-19.676-46.142l1.035-4.757c3.254-14.96-8.142-29.101-23.452-29.101H203.76l-9.39-48h312.405c11.29 0 21.054-7.869 23.452-18.902l45.216-208C578.695 78.139 567.299 64 551.991 64zM208 472c-13.234 0-24-10.766-24-24s10.766-24 24-24 24 10.766 24 24-10.766 24-24 24zm256 0c-13.234 0-24-10.766-24-24s10.766-24 24-24 24 10.766 24 24-10.766 24-24 24zm23.438-200H184.98l-31.31-160h368.548l-34.78 160z"></path></svg>'},i()(a.ZP.section,{title:"清单"},i()("p",i().trust(y.info))),y.can_use_point&&!y.paired?i()("div",i()("p","你可以使用 Point 抵价。每 100 Point 可以抵价 ￥1，请输入 100 的倍数。"),i()(a.ZP.formInput,{value:y.use_point_input,oninput:e=>{y.use_point_input=e.target.value}}),i()("p","注意：在抵价后即使支付未完成也不会返还已经使用的 Point 。"),i()(a.ZP.button,{onclick:async()=>{let e=await s.Z.UsePoints(y.use_point_input);e.success?i().route.set("/router/enter",{to:"/pay"}):a.ZP.showAlert("错误",e.message)}},"抵价")):null,y.paired?null:[y.showcodepwnpay&&!y.showingcodepwnpay?i()("p",["或者：",i()("a",{href:y.iframeurl,target:"_blank",style:{display:y.showingcodepwnpay?"none":"inline-block"},onclick:e=>{}},"自动结算[微信]（提供: CodePwn）")]):null,i()("br"),i()("br")],y.isfree&&!y.success?[i()("button.btn.btn-primary",{onclick:async()=>{let e=await a.ZP.getCaptchaInput("输入验证码","本操作需要输入验证码完成，请输入下方显示的验证码","验证码",!1,!1),r=await s.Z.RedeemForFree(e);r.success||a.ZP.showAlert("错误",r.message)}},"免费获取"),i()("br"),i()("br")]:null,y.error?i()("p",{style:{color:"red"}},y.error):null,y.paired?i()("p",{style:{color:"blue"}},y.paired_notice):null,y.fatal?null:[y.success?null:i()(a.ZP.button,{onclick:()=>{v(!0)}},"刷新状态"),i()("br"),i()("br"),i()("div",{style:{width:"40%",display:y.showingstripepay&&!y.paired?"":"none"}},i()("form#payment-form",i()("div#link-auth-el"),i()("div#payment-el"),i()("button.btn.btn-primary",{disabled:y.stripeloading,style:{width:"100%"},onclick:async e=>{e.preventDefault(),y.stripeloading=!0,i().redraw();const{error:r}=await f.confirmPayment({elements:m,confirmParams:{return_url:y.stripe_return_url}});alert(r.message),y.stripeloading=!1,i().redraw()}},"支付")),i()("br"),i()("br")),i()("a",{href:"#!/shopping_cart",onclick:e=>{e.preventDefault(),i().route.set("/shopping_cart")}},"返回")])};async function v(e){let r=await s.Z.CheckPayment();if(r.error)return h&&clearInterval(h),h=null,await a.ZP.showAlert("错误",r.error_message),void i().route.set("/shopping_cart");if(!y.paired){if(!r.paired){if(!y.isfree&&f&&!y.showingstripepay){y.showingstripepay=!0;let e=await s.Z.StripeCreateSession();m=f.elements({theme:"stripe",clientSecret:e.clientSecret}),m.create("linkAuthentication").mount("#link-auth-el"),m.create("payment",{layout:"tabs"}).mount("#payment-el"),y.stripe_return_url=e.return_url,i().redraw()}return void(e&&(y.error=r.message,i().redraw()))}y.error="",y.paired_notice=`请支付: ￥${r.price}`,y.paired=!0,i().redraw(),e=!1}r.success?(y.error="",y.paired_notice="支付成功！",y.success=!0,clearInterval(h),h=null,i().redraw()):e&&(y.error="尚未成功",i().redraw())}const g=y}]]);